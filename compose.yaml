services:
    frontend:
        build:
            context: .
            dockerfile: ./frontend/Dockerfile
        container_name: vite_frontend
        ports:
            - "3000:3000" # Serve frontend on localhost:3000
        env_file:
            - ./frontend/.env # Load environment variables from frontend .env file
        develop:
            watch:
                - action: sync
                  path: ./frontend/src
                  target: /app/frontend/src
                - action: rebuild
                  path: ./frontend/package.json
        depends_on:
            - backend

    backend:
        build:
            context: .
            dockerfile: ./backend/Dockerfile
        container_name: socket_backend
        ports:
            - "5000:5000" # Backend runs on port 5000
        env_file:
            - ./backend/.env # Load environment variables from backend .env file
        develop:
            watch:
                - action: sync
                  path: ./backend
                  target: /app/backend
                - action: rebuild
                  path: ./backend/package.json
        depends_on:
            - mongodb
    mongodb:
        image: mongo:7.0
        container_name: mongo_database
        restart: unless-stopped
        ports:
            - "27017:27017"
        command: ["mongod", "--config", "/etc/mongod.conf"]
        #command: ["mongod", "--auth", "--bind_ip_all"]
        env_file:
            - ./database/.env # Load environment variables from database .env file
        # environment:
        #     - MONGO_INITDB_ROOT_USERNAME=admin
        #     - MONGO_INITDB_ROOT_PASSWORD=password123
        volumes:
            # Mount the config file from database/config directory
            - ./database/config/mongod.conf:/etc/mongod.conf
            # Mount data directory for persistence
            - ./database/data:/data/db
            # Mount logs directory
            - ./database/logs:/var/log/mongodb

    # Database Admin UI
    # mongo-express:
    #     image: mongo-express:1.0
    #     container_name: mongodb_admin
    #     restart: unless-stopped
    #     ports:
    #         - "8081:8081"
    #     env_file:
    #         - ./database/.env # Load environment variables from database .env file
    #     depends_on:
    #         - mongodb
